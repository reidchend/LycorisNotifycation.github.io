<!DOCTYPE html>
<html>
<head>
    <title>Token Bridge</title>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

        const firebaseConfig = {
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyCwQW8VD-bfOIbWhEUNh-fjOe6vkytrQPU",
              authDomain: "lycoris-alertas.firebaseapp.com",
              projectId: "lycoris-alertas",
              storageBucket: "lycoris-alertas.firebasestorage.app",
              messagingSenderId: "828115636853",
              appId: "1:828115636853:web:b988d986b46a8ece02de3c",
              measurementId: "G-XMZPNBQL1S"
            };

        const VAPID_KEY = "BHRziZv_mLHtVbmN6oR6rt_rIxTLjjbD-G1oGwG4lx9ggvh3gp2Qu1qnRxB13zQdj5mOsfl0vNKKYjMsJUDixAY";
        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        async function initBridge() {
            try {
                statusDiv.innerText = "Solicitando permiso...";
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                    statusDiv.innerText = "Permiso concedido. Obteniendo token...";
                    
                    const token = await getToken(messaging, { vapidKey: VAPID_KEY });
                    
                    if (token) {
                        statusDiv.innerText = "Token generado con Ã©xito.";
                        // ENVIAR AL APP DE FLET
                        if (window.fletHandler) {
                            window.fletHandler.postMessage(token);
                        } else {
                            console.log("Token:", token);
                            statusDiv.innerText = "Token: " + token + " (Flet no detectado)";
                        }
                    }
                } else {
                    statusDiv.innerText = "Permiso denegado por el usuario.";
                    window.fletHandler.postMessage("error: denied");
                }
            } catch (error) {
                console.error(error);
                statusDiv.innerText = "Error: " + error.message;
                if (window.fletHandler) {
                    window.fletHandler.postMessage("error: " + error.message);
                }
            }
        }

        initBridge();
    </script>
</body>
</html>
</html>
